{
  "data": {
    "type": "metadatadisplay_entity--metadatadisplay_entity",
    "id": "ad7aab5a-4bb3-43f2-8328-2b62895a3821",
    "attributes": {
      "name": "IIIF Presentation API 3.0 Manifest",
      "twig": "{# This Template generates IIIF 3.0 DRAFT Presentation API Manifest from a Strawberry Field\nJSON.\n\nStructures passed from Archipelago are\n- node\n  The full Node entity\n- data\n  The Full JSON Structure converted in an Array\n- iiif_server\n  The publicly available IIIF Server (Global Setting)\n\nSince JSON was decoded into the 'data' values are valid PHP but could not\nbe valid JSON when outputting. So We use data.description|json_encode|raw\nWithout Double quotes.\n\n#}\n{% set Webserverurl =  url('<front>')|render|replace({':8001\/':''}) ~ ':8183\/iiif\/2\/' %}\n{% set IIIFserverurl = iiif_server ? iiif_server ~ '\/': Webserverurl %}\n{% set currenturl = url('<current>')|render %}\n{% if node.id %}\n   {% set nodeurl = url('entity.node.canonical', {'node': node.id}, {'absolute': true}) %}\n{% else %}\n   {% set nodeurl = currenturl %}\n{% endif%}\n{% set len = language.getId() ? language.getId() : \"en\" %}\n{% set max_thumb_width = 240 %}\n{\n\"@context\": [\n  \"http:\/\/www.w3.org\/ns\/anno.jsonld\",\n  \"http:\/\/iiif.io\/api\/presentation\/3\/context.json\"\n],\n\"type\": \"Manifest\",\n\"id\": \"{{ currenturl }}\",\n\"label\": {\n\"{{ len }}\": [\n{{ node.label|json_encode|raw }}\n]\n},\n\"requiredStatement\": {\n\"label\": { \"en\": [ \"Attribution\" ] },\n\"value\": { \"en\": [ \"Provided by Archipelago Deployment\" ] }\n},\n\"metadata\": [\n{% for agent in attribute(data, 'edm_agent') %}\n    {\n    \"label\": {\n    \"{{ len }}\": [\n    {{ agent.role_label|json_encode|raw }}\n    ]\n    },\n    \"value\": {\n    \"{{ len }}\": [\n    {{ agent.name_label|json_encode|raw }}\n    ]\n    }\n    },\n{% endfor %}\n{\n\"label\": {\n\"{{ len }}\": [\n\"description\"\n]\n},\n\"value\": {\n\"{{ len }}\": [\n{{ data.description|json_encode|raw }}\n]\n}\n},\n{\n\"label\": {\n\"{{ len }}\": [\n\"navDate\"\n]\n},\n\"value\":  {\n\"{{ len }}\": [\n\"{{ node.getChangedTime|date(\"F jS \\\\a\\\\t g:ia\") }}\"\n]\n}\n},\n{\n\"label\": {\n\"{{ len }}\": [\n\"license\"\n]\n},\n\"value\": {\n\"{{ len }}\": [\n\"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\"\n]\n}\n}\n],\n{% if attribute(data, 'memberof') %}\n    {% set currentnode = 'node\/' ~ data.memberof %}\n    \"within\": \"{{ url(currentnode) }}\",\n{% else %}\n    {% set currentnode = '<current>' %}\n{% endif %}\n\"items\": [\n{% for page in attribute(data, 'as:image') %}\n   {% set cantaloupeid  = IIIFserverurl ~ page['url']|replace({'s3:\/\/':''})|replace({'private:\/\/':''})|url_encode %}\n   {% if page[\"flv:exif\"] %}\n      {% set width = page[\"flv:exif\"].ImageWidth %}\n   {% else  %}\n      {% set width = 1200 %}\n  {% endif %}\n  {% if page[\"flv:exif\"] %}\n      {% set height = page[\"flv:exif\"].ImageHeight %}\n  {% else  %}\n      {% set height = 1600 %}\n  {% endif %}\n  {% set thumb_width = width < max_thumb_width ? with: max_thumb_width %}\n  {% set thumb_height = (thumb_width\/width * height)|round() %}\n  {% set thumbnail %}\n\"thumbnail\": [{\n  \"id\": \"{{ cantaloupeid }}\/full\/{{thumb_width}},\/0\/default.jpg\",\n  \"type\": \"Image\",\n  \"format\": \"image\/jpeg\",\n  \"width\": {{ thumb_width }},\n  \"height\": {{ thumb_height }}\n}],\n  {% endset %}\n    {\n      \"id\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ loop.index }}\",\n      \"type\": \"Canvas\",\n      \"label\": { \"none\": [ \"p. {{ loop.index }}\" ] },\n      {{ thumbnail }}\n      \"height\": {{ width }},\n      \"width\": {{ height }},\n      \"items\": [\n        {\n          \"id\": \"{{ nodeurl }}\/iiif\/page\/p{{ loop.index }}\/1\",\n          \"type\": \"AnnotationPage\",\n          \"items\": [\n            {\n              \"id\": \"{{ nodeurl }}\/iiif\/annotation\/p{{ loop.index }}\",\n              \"type\": \"Annotation\",\n              \"motivation\": \"painting\",\n              {{ thumbnail }}\n              \"body\": {\n                \"id\": \"{{ cantaloupeid }}\/full\/full,\/0\/default.jpg\",\n                \"type\": \"Image\",\n                \"format\": \"image\/jpeg\",\n                \"service\": [\n                  {\n                    \"id\": \"{{ cantaloupeid }}\",\n                    \"type\": \"ImageService2\",\n                    \"profile\": \"level2\"\n                  }\n                ],\n                \"height\": {{ width }},\n                \"width\": {{ height }}\n              },\n              \"target\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ loop.index }}\"\n            }\n          ]\n        }\n      ]\n      {# Leaving W3C annotations out until we have a way of referencing each one via our own Metadata Endpoint which will require and extra argument for the page\n      {{ nodeurl }}\/iiif\/comments\/p{{ cantaloupeid }}\/1\n      ,\n      \"annotations\": [\n        {\n          \"id\": \"{{ nodeurl }}\/iiif\/comments\/p{{ loop.index }}\/1\",\n          \"type\": \"AnnotationPage\"\n        }\n      ]#}\n    }{{ not loop.last ? ',' : '' }}\n{% endfor %}\n],\n\"structures\": [{\n\"id\": \"{{ nodeurl }}\/iiif\/range\/r1\",\n\"type\": \"Range\",\n\"label\": {\n\"{{ len }}\": [\n{{ node.label|json_encode|raw  }}\n]\n},\n\"items\": [\n{% for range in attribute(data, 'as:image') %}\n    {\n       \"id\":  \"{{ nodeurl }}\/iiif\/canvas\/p{{ loop.index }}\",\n       \"type\": \"Canvas\"\n    }{{ not loop.last ? ',' : '' }}\n{% endfor %}\n]\n}]\n}",
      "langcode": "und",
      "mimetype": "application/ld+json"
    }
  }
}
