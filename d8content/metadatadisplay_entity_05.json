{
  "data": {
    "type": "metadatadisplay_entity--metadatadisplay_entity",
    "id": "05fe574d-7534-4261-b49b-895b94ac3fce",
    "attributes": {
      "name": "IIIF Presentation API 2.1 Manifest",
      "twig": "{# \nUpdated 22\/11\/2021 for RC3\n\nThis Template generates IIIF 2.1 Presentation API Manifest from a Strawberry Field\nJSON.\n\nStructures passed from Archipelago are\n- node\n  The full Node entity\n- data\n  The Full JSON Structure converted in an Array\n- iiif_server\n  The publicly available IIIF Server (Global Setting)\n\nSince JSON was decoded into the 'data' values are valid PHP but could not\nbe valid JSON when outputting. So We use data.description|json_encode|raw\nWithout Double quotes.\n\nUpdated Dec 14th 2020\n- Add @id to annotation\n- Widths\/Heights for DOCS and IMAGES\n#}\n{% set Webserverurl =  url('<front>')|render|replace({':8001\/':''}) ~ ':8183\/iiif\/2\/' %}\n{% set IIIFserverurl = iiif_server ? iiif_server ~ '\/': Webserverurl %}\n{% set currenturl = url('<current>')|render %}\n{% if node.id %}\n  {% set nodeurl = url('entity.node.canonical', {'node': node.id}, {'absolute': true}) %}\n{% else %}\n  {% set nodeurl = currenturl ~ '\/iiif\/manifest' %}\n{% endif%}\n{% set pageCount =  0 %} \n{% set max_thumb_width = 240 %}\n{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\n{% if data.rights|length > 0 or data.rights_statements|length > 0 %}\n\t{% if data.rights|length > 0 %} \n\t\t{% set computed_rights = data.rights %}\n\t{% endif %}\n{% elseif data.rights_statements|length > 0 %}\n\t{% if data.rights_statements in ['In Copyright'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - EU Orphan Work'] %} \n    \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-OW-EU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Educational Use Permitted'] %} \n\t   \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Non-Commercial Use Permitted'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-NC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Rights-holder(s) Unlocatable or Unidentifiable'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-RUU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - Contractual Restrictions'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-CR\/1.0\/\" %}\n\t{% endif %} \n\t{% if data.rights_statements in ['No Copyright - Non-Commercial Use Only'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-NC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - Other Known Legal Restrictions'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-OKLR\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - United States'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-US\/1.0\/\" %}\n\t{% endif %} \n\t{% if data.rights_statements in ['Copyright Not Evaluated'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/CNE\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['Copyright Undetermined'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/UND\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Known Copyright'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NKC\/1.0\/\" %}\n\t{% endif %}\n{% endif %}\n{\n\"@context\": [\n\"http:\/\/www.w3.org\/ns\/anno.jsonld\",\n\"http:\/\/iiif.io\/api\/presentation\/2\/context.json\"\n],\n\"@type\": \"sc:Manifest\",\n\"@id\": \"{{ currenturl }}\",\n\"label\": \"{{ node.label }}\",\n\"description\": {{ data.description|json_encode|raw }},\n\"metadata\": [\n{% for agent in attribute(data, 'edm_agent') %}\n    {\n    \"label\": {{ agent.role_label|json_encode|raw }},\n    \"value\": {{ agent.name_label|json_encode|raw }}\n    },\n{% endfor %}\n{\n\"label\": \"description\",\n\"value\": {{ data.description|json_encode|raw }}\n},\n{\n\"label\": \"type\",\n\"value\": {{ data.type|json_encode|raw }}\n},\n{\n\"label\": \"navDate\",\n\"value\": \"{{ node.getChangedTime|date(\"F jS \\\\a\\\\t g:ia\") }}\"\n},\n{\n\"label\": \"license\",\n\"value\": {{ computed_rights|json_encode|raw }}\n},\n{\n\"label\": \"attribution\",\n\"value\": \"Provided by Archipelago's demo\"\n}\n],\n{% if attribute(data, 'memberof') %}\n    {% set currentnode = 'node\/' ~ data.memberof %}\n    \"within\": \"{{ url(currentnode) }}\",\n{% else %}\n    {% set currentnode = '<current>' %}\n{% endif %}\n{# This processes docs like PDF #}\n\"sequences\": [\n{\n\"@id\": \"{{ nodeurl }}\/sequence\/normal\",\n\"@type\": \"sc:Sequence\",\n\"label\": \"Current Page Order\",\n\"viewingDirection\": \"left-to-right\",\n\"viewingHint\": \"paged\",\n\"canvases\": [\n{% if attribute(data, 'as:document')|length > 0 %}  \n  {% for document in attribute(data, 'as:document') if document['flv:exif'].PageCount %}\n    {% set cantaloupeid  = IIIFserverurl ~ document['url']|replace({'s3:\/\/':''})|replace({'private:\/\/':''})|url_encode %}\n{# Only Fetch the first Document #}\n    {% if loop.index == 1 %} \n      {% set pageCount =  document['flv:exif'].PageCount %}\n      {% for pagenumber in 1..pageCount %}\n         {% if attribute(document[\"flv:pdfinfo\"], pagenumber) %}\n            {% set width = attribute(document[\"flv:pdfinfo\"], pagenumber).width ? (attribute(document[\"flv:pdfinfo\"], pagenumber).width * 1.333)|round : 600 %}\n            {% set height = attribute(document[\"flv:pdfinfo\"], pagenumber).height ? (attribute(document[\"flv:pdfinfo\"], pagenumber).height * 1.333)|round : 450 %} \n         {% else  %}\n            {% if attribute(document[\"flv:identify\"], pagenumber) %}\n               {% set width = attribute(document[\"flv:identify\"], pagenumber).width ? (attribute(document[\"flv:identify\"], pagenumber).width * 1.333)|round : 600 %}\n               {% set height = attribute(document[\"flv:identify\"], pagenumber).height ? (attribute(document[\"flv:identify\"], pagenumber).height * 1.333)|round : 450 %} \n            {% else  %}\n               {% set width = 600 %}\n               {% set height = 450 %}\n            {% endif %}\n         {% endif %}\n         {% set thumb_width = width < max_thumb_width ? width: max_thumb_width %}\n         {% set thumb_height = (thumb_width\/width * height)|round() %}\n         {% set thumbnail %}\n\"thumbnail\": [{\n  \"id\": \"{{ cantaloupeid }}\/full\/{{thumb_width}},\/0\/default.jpg?page={{ pagenumber }}\",\n  \"type\": \"Image\",\n  \"format\": \"image\/jpeg\",\n  \"width\": {{ thumb_width }},\n  \"height\": {{ thumb_height }}\n}],\n         {% endset %}\n         \n         \n    {\n    \"@id\": \"{{ nodeurl }}\/iiif\/{{ document['dr:uuid'] }}\/canvas\/p{{ loop.index }}\",\n    \"@type\": \"sc:Canvas\",\n    \"label\": \"p. {{ loop.index }}\",\n    \"width\": {{ width }},\n    \"height\": {{ height }},\n    {{ thumbnail }}\n    \"images\": [{\n    \"@type\": \"oa:Annotation\",\n    \"motivation\": \"sc:painting\",\n    {{ thumbnail }}\n    \"@id\": \"{{ nodeurl }}\/annotation\/p{{ loop.index }}\",\n    \"resource\":{\n      \"@id\": \"{{ cantaloupeid }}\/full\/full\/0\/default.jpg?page={{ pagenumber }}\",\n      \"@type\": \"dctypes:Image\",\n      \"format\": \"image\/jpeg\",\n      \"width\": {{ width }},\n      \"height\": {{ height }}\n    },\n    \"on\": \"{{ nodeurl }}\/iiif\/{{ document['dr:uuid'] }}\/canvas\/p{{ loop.index }}\"\n    }]\n    }{{ not loop.last ? ',' : '' }}\n      {% endfor %}\n    {% endif %}\n  {% endfor %} \n{% endif %}\n{% if (attribute(data, 'as:image')|length > 0 and pageCount == 0) or (attribute(data, 'as:image')|length > 0 and data.type == 'Conversation') %}\n  {% if pageCount > 0 %}\n,\n  {% endif %}\n{# This processes images #}\n{% for page in attribute(data, 'as:image') %}\n  {% set cantaloupeid  = IIIFserverurl ~ page['url']|replace({'s3:\/\/':''})|replace({'private:\/\/':''})|url_encode %}\n  {% if page[\"flv:exif\"] %}\n    {% set width = page[\"flv:exif\"].ImageWidth %}\n  {% else  %}\n    {% set width = 600 %}\n  {% endif %}\n  {% if page[\"flv:exif\"] %}\n    {% set height = page[\"flv:exif\"].ImageHeight %}\n  {% else  %}\n    {% set height = 800 %}\n  {% endif %}\n    {\n    \"@id\": \"{{ nodeurl }}\/canvas\/p{{ loop.index + pageCount}}\",\n    \"@type\": \"sc:Canvas\",\n    \"label\": \"Image {{ loop.index }}\",\n    \"width\": {{ width }},\n    \"height\": {{ height }},\n    \"images\": [{\n      \"@type\": \"oa:Annotation\",\n      \"@id\": \"{{ nodeurl }}\/annotation\/p{{ loop.index + pageCount}}\",\n      \"motivation\": \"sc:painting\",\n      \"resource\":{\n        \"@id\": \"{{ cantaloupeid }}\/full\/{{ width }},\/0\/default.jpg\",\n        \"@type\": \"dctypes:Image\",\n        \"format\": \"image\/jpeg\",\n        \"service\": {\n           \"@context\": \"http:\/\/iiif.io\/api\/image\/2\/context.json\",\n           \"@id\": \"{{ cantaloupeid }}\",\n           \"profile\": \"http:\/\/iiif.io\/api\/image\/2\/level2.json\"\n        },\n        \"width\": {{ width }},\n        \"height\": {{ height }}\n      },\n    \"on\": \"{{ nodeurl }}\/canvas\/p{{ loop.index + pageCount}}\"\n    }]\n    }{{ not loop.last ? ',' : '' }}\n  {% endfor %}\n{% endif %}\n]}], \n\"structures\": [{\n\"@id\": \"{{ nodeurl }}\/range\/r1\",\n\"@type\": \"sc:Range\",\n\"label\": \"Introduction\",\n\"canvases\": [\n{% if attribute(data, 'as:document')|length > 0 %}    \n  {% for document in attribute(data, 'as:document') if document['flv:exif'].PageCount %}\n    {% if loop.index == 1 %} \n      {% set pageCount =  document['flv:exif'].PageCount %}\n      {% for pagenumber in 1..pageCount %}\n    \"{{ nodeurl }}\/canvas\/p{{ loop.index }}\"{{ not loop.last ? ',' : '' }}\n      {% endfor %}\n    {% endif %}\n {% endfor %}\n{% endif %}\n{% if (attribute(data, 'as:image')|length > 0 and pageCount == 0) or (attribute(data, 'as:image')|length > 0 and data.type == 'Conversation') %}\n  {% if pageCount > 0 %}\n,\n  {% endif %}\n{% for range in attribute(data, 'as:image') %}\n    \"{{ nodeurl }}\/canvas\/p{{ loop.index + pageCount }}\"{{ not loop.last ? ',' : '' }}\n  {% endfor %}\n{% endif %}  \n]\n}]\n}\n\n",
      "langcode": "und",
      "mimetype": "application/ld+json"
    }
  }
}
