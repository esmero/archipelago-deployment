{"data":{"id":"d37a75ec-5da9-4374-b190-71385e630ded","type":"metadatadisplay_entity--metadatadisplay_entity","attributes":{"twig":"{# \r\nUpdated 01\/20\/2023 for 1.1.0\r\nChanges:\r\n  - Better Labeling for Items\r\n  - Adds Rights\r\n  - Fixes on Canvas IDs\r\n  - Deals with PDFs too, joining them all together\r\n  - Adds MarkDown support for Description\r\n  - Fixes Structures\/Canvas IDs\r\n  - Adds Annotations for Images\r\n  - Adds PDF\/Document\/pages\r\n  - Adds Thumbnail for Video\r\n  - Fixes mirador_path to handle both standard and self-closing polygon tags.\r\n\r\nThis Template generates IIIF 3.0 Canvas only Partial API Manifest from a Strawberry Field\r\nJSON to be used by a Drupal Views (REST) to generate a simpler to parse\/join listing of Canvases\r\nFor a Creative Works Series Manifest\r\n\r\nNOTE: if you modify this make sure you also open\/save the parent \"IIIF Presentation API 3 Creative Works Series Manifest\" \r\nMetadatadisplay. Why? because Templates are cached\/render arrays too, so the other one will not know this happened.\r\n\r\n- Includes Annotations for Images\r\n- Includes Thumbnail for Videos\r\n\r\nStructures passed from Archipelago are\r\n- node\r\n  The full Node entity\r\n- data\r\n  The Full JSON Structure converted in an Array\r\n- iiif_server\r\n  The publicly available IIIF Server (Global Setting)\r\n\r\nSince JSON was decoded into the 'data' values are valid PHP but could not\r\nbe valid JSON when outputting. So We use data.description|json_encode|raw\r\nWithout Double quotes.\r\n#}\r\n{% spaceless %}\r\n{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\r\n{% if data.rights|length > 0 or data.rights_statements|length > 0 %}\r\n\t{% if data.rights|length > 0 %} \r\n\t\t{% set computed_rights = data.rights %}\r\n\t{% endif %}\r\n{% elseif data.rights_statements|length > 0 %}\r\n\t{% if data.rights_statements in ['In Copyright'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - EU Orphan Work'] %} \r\n    \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-OW-EU\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - Educational Use Permitted'] %} \r\n\t   \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - Non-Commercial Use Permitted'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-NC\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - Rights-holder(s) Unlocatable or Unidentifiable'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-RUU\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Copyright - Contractual Restrictions'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-CR\/1.0\/\" %}\r\n\t{% endif %} \r\n\t{% if data.rights_statements in ['No Copyright - Non-Commercial Use Only'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-NC\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Copyright - Other Known Legal Restrictions'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-OKLR\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Copyright - United States'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-US\/1.0\/\" %}\r\n\t{% endif %} \r\n\t{% if data.rights_statements in ['Copyright Not Evaluated'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/CNE\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['Copyright Undetermined'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/UND\/1.0\/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Known Copyright'] %} \r\n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NKC\/1.0\/\" %}\r\n\t{% endif %}\r\n{% endif %}\r\n{# Mirador 3 has this weird CSS thing that puts the max of thumb to that size #}\r\n{% set max_thumb_width = 240 %}\r\n{%- set GenericIIIFserverurl =  url('<front>')|render|replace({':8001\/':''}) ~ ':8183\/iiif\/2\/' %}\r\n{%- set Webserverurl =  url('<front>')|render -%}\r\n  {% set IIIFserverurl = iiif_server ? iiif_server ~ '\/': GenericIIIFserverurl %}\r\n    {% set currenturl = url('<current>')|render %}\r\n      {% if node.id %}\r\n          {% set nodeurl = url('entity.node.canonical', {'node': node.id}, {'absolute': true}) %}\r\n      {% else %}\r\n          {% set nodeurl = currenturl %}\r\n      {% endif%}\r\n            {% set len = language.getId() ? language.getId() : \"en\" %}\r\n{% endspaceless %}\r\n{% set metadata %}\r\n\"metadata\": [\r\n{% for agent in attribute(data, 'edm_agent') %}\r\n    {\r\n      \"label\": {\r\n        \"{{ len }}\": [\r\n          {{ agent.role_label|json_encode|raw }}\r\n        ]\r\n      },\r\n      \"value\": {\r\n        \"{{ len }}\": [\r\n          {{ agent.name_label|json_encode|raw }}\r\n        ]\r\n      }\r\n    },\r\n{% endfor %}\r\n{\r\n\"label\": {\r\n\"{{ len }}\": [\r\n\"description\"\r\n]\r\n},\r\n\"value\": {\r\n\"{{ len }}\": [\r\n{{ data.description|json_encode|raw }}\r\n]\r\n}\r\n},\r\n{\r\n\"label\": {\r\n\"{{ len }}\": [\r\n\"navDate\"\r\n]\r\n},\r\n\"value\":  {\r\n\"{{ len }}\": [\r\n\"{{ node.getChangedTime|date(\"F jS \\\\a\\\\t g:ia\") }}\"\r\n]\r\n}\r\n},\r\n{\r\n\"label\": {\r\n\"{{ len }}\": [\r\n\"license\"\r\n]\r\n},\r\n\"value\": {\r\n\"{{ len }}\": [\r\n{{ computed_rights|json_encode|raw }}\r\n]\r\n}\r\n}\r\n],\r\n{% endset %}\r\n{\r\n\"items\": [\r\n{%- set document_count = attribute(data, 'as:document')|length -%}\r\n{%- set TotalpageCount = 0 -%}\r\n{%- for document in attribute(data, 'as:document') if document['flv:exif'].PageCount -%}\r\n{%- set TotalpageCount = (TotalpageCount + document['flv:exif'].PageCount) -%}\r\n{%- endfor -%}\r\n{% for document in attribute(data, 'as:document') if document['flv:exif'].PageCount %}\r\n   {%- set pageCount =  document['flv:exif'].PageCount -%}\r\n   {%- set cantaloupeid  = IIIFserverurl ~ document['url']|replace({'s3:\/\/':''})|replace({'private:\/\/':''})|url_encode -%}\r\n   {%  for pagenumber in 1..pageCount %}{\r\n        {%- set itemCount = itemCount + 1 -%}\r\n        {% if attribute(document[\"flv:pdfinfo\"], pagenumber) %}\r\n            {% set width = attribute(document[\"flv:pdfinfo\"], pagenumber).width ? (attribute(document[\"flv:pdfinfo\"], pagenumber).width * 1.333)|round : 600 %}\r\n            {% set height = attribute(document[\"flv:pdfinfo\"], pagenumber).height ? (attribute(document[\"flv:pdfinfo\"], pagenumber).height * 1.333)|round : 450 %} \r\n         {% else  %}\r\n            {% if attribute(document[\"flv:identify\"], pagenumber) %}\r\n               {% set width = attribute(document[\"flv:identify\"], pagenumber).width ? (attribute(document[\"flv:identify\"], pagenumber).width * 1.333)|round : 600 %}\r\n               {% set height = attribute(document[\"flv:identify\"], pagenumber).height ? (attribute(document[\"flv:identify\"], pagenumber).height * 1.333)|round : 450 %} \r\n            {% else  %}\r\n               {% set width = 600 %}\r\n               {% set height = 450 %}\r\n            {% endif %}\r\n         {% endif %}\r\n         {% set thumb_width = width < max_thumb_width ? width: max_thumb_width %}\r\n         {% set thumb_height = (thumb_width\/width * height)|round() %}\r\n         {% set thumbnail %}\r\n  \"thumbnail\": [{\r\n  \"id\": \"{{ cantaloupeid }}\/full\/{{thumb_width}},\/0\/default.jpg?page={{ pagenumber }}\",\r\n  \"type\": \"Image\",\r\n  \"format\": \"image\/jpeg\",\r\n  \"width\": {{ thumb_width }},\r\n  \"height\": {{ thumb_height }}\r\n}],\r\n  {% endset %}  \r\n      \"id\": \"{{ nodeurl }}\/iiif\/{{ document['dr:uuid'] }}\/canvas\/p{{ pagenumber }}\",\r\n      \"type\": \"Canvas\",\r\n      \"label\": { \"{{ len }}\": [\r\n      {%- if (pageCount > 1) -%}\r\n      {{ (loop.index ~ ' of ' ~ pageCount ~ ' pages: ' ~ data.label)|json_encode|raw }}\r\n      {% else %}\r\n       {{ data.label|json_encode|raw }}\r\n      {%- endif -%}\r\n      ]},\r\n      {{ thumbnail }}\r\n      \"height\": {{ height }},\r\n      \"width\": {{ width }},\r\n      \"items\": [\r\n        {\r\n          \"id\": \"{{ nodeurl }}\/iiif\/{{ document['dr:uuid'] }}\/page\/p{{ pagenumber}}\",\r\n          \"type\": \"AnnotationPage\",\r\n          \"items\": [\r\n            {\r\n              \"id\": \"{{ nodeurl }}\/iiif\/{{ document['dr:uuid'] }}\/annotation\/p{{ pagenumber }}\",\r\n              \"type\": \"Annotation\",\r\n              \"motivation\": \"painting\",     \r\n              {{ thumbnail }}          \r\n              \"body\": {\r\n                \"id\": \"{{ cantaloupeid }}\/full\/full\/0\/default.jpg?page={{ pagenumber }}\",\r\n                \"type\": \"Image\",\r\n                \"format\": \"image\/jpeg\",\r\n                \"height\": {{ height }},\r\n                \"width\": {{ width }}\r\n              },\r\n              \"target\": \"{{ nodeurl }}\/iiif\/{{ document['dr:uuid'] }}\/canvas\/p{{ pagenumber }}\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n      {# Leaving W3C annotations out until we have a way of referencing each one via our own Metadata Endpoint which will require and extra argument for the page\r\n      {{ nodeurl }}\/iiif\/comments\/p{{ cantaloupeid }}\/1\r\n      ,\r\n      \"annotations\": [\r\n        {\r\n          \"id\": \"{{ nodeurl }}\/iiif\/comments\/p{{ loop.index }}\/1\",\r\n          \"type\": \"AnnotationPage\"\r\n        }\r\n]#}\r\n    }{{ itemCount < TotalpageCount ? ',' : '' }}\r\n{% endfor %}\r\n{% endfor %}\r\n{#- ImagesManifest -#}\r\n{#- Count Images upfront -#}\r\n{%- if (attribute(data, 'as:image')|length > 0) -%}\r\n{%- if itemCount > 0 -%}\r\n,\r\n{%- endif -%}\r\n{%- endif -%}\r\n{% for page in attribute(data, 'as:image') %}\r\n   {\r\n   {%- set itemCount = itemCount + 1 %}\r\n   {%- set cantaloupeid  = IIIFserverurl ~ page['url']|replace({'s3:\/\/':''})|replace({'private:\/\/':''})|url_encode -%}\r\n   {%- if page[\"flv:exif\"] -%}\r\n      {%- set width = page[\"flv:exif\"].ImageWidth -%}\r\n   {%- else  -%}\r\n      {%- set width = 1200 -%}\r\n  {%- endif -%}\r\n  {%- if page[\"flv:exif\"] -%}\r\n      {%- set height = page[\"flv:exif\"].ImageHeight -%}\r\n  {%- else  -%}\r\n      {%- set height = 1600 -%}\r\n  {%- endif -%}\r\n  {%- set thumb_width = width < max_thumb_width ? width: max_thumb_width -%}\r\n  {%- set thumb_height = (thumb_width\/width * height)|round() -%}\r\n{% set thumbnail -%}\r\n\"thumbnail\": [\r\n        {\r\n          \"id\": \"{{ cantaloupeid }}\/full\/{{thumb_width}},\/0\/default.jpg\",\r\n          \"type\": \"Image\",\r\n          \"format\": \"image\/jpeg\",\r\n          \"width\": {{ thumb_width }},\r\n          \"height\": {{ thumb_height }}\r\n        }\r\n      ],\r\n{%- endset %}\r\n      \"id\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ itemCount }}\",\r\n      \"type\": \"Canvas\",\r\n      \"label\": { \"{{ len }}\": [\r\n      {%- if (image_count > 1) -%}\r\n      {{ (loop.index ~ ' of ' ~ image_count ~ ' images: ' ~ data.label)|json_encode|raw }}\r\n      {% else %}\r\n       {{ data.label|json_encode|raw }}\r\n      {%- endif -%}\r\n      ]},\r\n      {{ thumbnail }}\r\n      \"height\": {{ height }},\r\n      \"width\": {{ width }},\r\n      \"items\": [\r\n        {\r\n          \"id\": \"{{ nodeurl }}\/iiif\/page\/p{{ itemCount}}\",\r\n          \"type\": \"AnnotationPage\",\r\n          \"items\": [\r\n            {\r\n              \"id\": \"{{ nodeurl }}\/iiif\/annotation\/p{{ itemCount }}\",\r\n              \"type\": \"Annotation\",\r\n              \"motivation\": \"painting\",     \r\n              {{ thumbnail }}          \r\n              \"body\": {\r\n                \"id\": \"{{ cantaloupeid }}\/full\/full\/0\/default.jpg\",\r\n                \"type\": \"Image\",\r\n                \"format\": \"image\/jpeg\",\r\n                \"service\": [\r\n                  {\r\n                    \"id\": \"{{ cantaloupeid }}\",\r\n                    \"type\": \"ImageService2\",\r\n                    \"profile\": \"level2\"\r\n                  }\r\n                ],\r\n                \"height\": {{ height }},\r\n                \"width\": {{  width }}\r\n              },\r\n              \"target\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ itemCount }}\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n {# Annotations for this canvas\r\n \"annotations\": [\r\n        {\r\n          \"id\": \"https:\/\/iiif.io\/api\/cookbook\/recipe\/0021-tagging\/page\/p2\/1\",\r\n          \"type\": \"AnnotationPage\",\r\n          \"items\": [\r\n            {\r\n              \"id\": \"https:\/\/iiif.io\/api\/cookbook\/recipe\/0021-tagging\/annotation\/p0002-tag\",\r\n              \"type\": \"Annotation\",\r\n              \"motivation\": \"tagging\",\r\n              \"body\": {\r\n                \"type\": \"TextualBody\",\r\n                \"value\": \"GÃ¤nseliesel-Brunnen\",\r\n                \"language\": \"de\",\r\n                \"format\": \"text\/plain\"\r\n              },\r\n              \"target\": \"https:\/\/iiif.io\/api\/cookbook\/recipe\/0021-tagging\/canvas\/p1#xywh=265,661,1260,1239\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n #}      \r\n      {%- if data[\"ap:annotationCollection\"][cantaloupeid ~ '\/info.json'] is defined %}\r\n       ,\r\n       \"annotations\": [\r\n           {\r\n           \"id\": \"{{ nodeurl }}\/iiif\/comments\/p{{ itemCount }}\",\r\n           \"type\": \"AnnotationPage\",\r\n           \"items\": [\r\n        {% for annotation in data[\"ap:annotationCollection\"][cantaloupeid ~ '\/info.json'] %}\r\n    \t{\r\n               \"id\": \"{{ nodeurl }}\/iiif\/comments\/p{{ itemCount }}\/{{ annotation.id }}\",\r\n               \"motivation\": \"tagging\",\r\n               {% set temp_annotation_body = [] %}\r\n               {# We need to enrich here, missing language and format #}\r\n               {% if annotation.body is iterable %}\r\n                 {% for body in annotation.body %}\r\n                   {% set annotation_body = body|merge({'language': len, 'format': 'text\/plain'}) %}\r\n                   {% set temp_annotation_body = temp_annotation_body|merge([annotation_body]) %}\r\n                 {% endfor %}\r\n               {% else %}\r\n               {% endif %}\r\n               \"body\": {{ temp_annotation_body|json_encode|raw }},\r\n               \"type\": {{ annotation.type|json_encode(constant('JSON_FORCE_OBJECT'))|raw }}\r\n               {# check target type: If polygon we need the selector, if a square, we need the xywh #}\r\n               {% if annotation.target.selector.type == \"FragmentSelector\" %}\r\n               {# MIRADOR does not know how to hande \"pixel:\" in the fragment coordinates selector #}\r\n                 {% set target = nodeurl|render ~ \"\/iiif\/canvas\/p\" ~ itemCount ~ '#' ~ annotation.target.selector.value|replace({\"pixel:\" : \"\"}) %}\r\n                 ,\"target\": {{ target|json_encode|raw }}\r\n               {% else %}\r\n               {# Parse our polygon point values into path for Mirador #}\r\n                 {% if 'points=\"' in annotation.target.selector.value %}\r\n                   {% set mirador_path = annotation.target.selector.value | preg_replace('\/.+?points=\"\/','') | preg_replace('\/\".*\/','') %}\r\n                   {% set mirador_path = \"M\" ~ (mirador_path|split(\" \")|join(\"L\")) ~ \" z\" %}\r\n                   {% set target = {\r\n                     \"source\" : nodeurl|render ~ \"\/iiif\/canvas\/p\" ~ itemCount,\r\n                     \"selector\": {\r\n                       \"type\":  annotation.target.selector.type,\r\n                       \"value\": '<svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\"><g><path d=\"' ~ mirador_path ~ '\"\/><\/g><\/svg>'\r\n                     },\r\n                     \"type\": \"SpecificResource\"\r\n               \t   } %}\r\n                   ,\"target\": {{ target|json_encode|raw }}\r\n                 {% endif %}\r\n               {% endif %}\r\n       }{{ not loop.last ? ',' : '' }}      \r\n       {% endfor -%}\r\n       ]}]\r\n      {% endif %}\r\n    }{{ not loop.last ? ',' : '' }}\r\n{% endfor %}\r\n{#- Video\/Audio Manifest -#}\r\n{%- if (attribute(data, 'as:video')|length > 0) -%}\r\n{%- if itemCount > 0 -%}\r\n,\r\n{%- endif -%}\r\n{#- Count Video upfront -#}\r\n{%- set video_count = attribute(data, 'as:video')|length -%}\r\n{% for video in attribute(data, 'as:video') %}\r\n  {%- set itemCount = itemCount + 1 -%}\r\n  {%- if video[\"flv:exif\"] -%}\r\n    {%- set width = video[\"flv:mediainfo\"].videos[0].width.absoluteValue|default(720) -%}\r\n  {% else  %}\r\n    {%- set width = 720 -%}\r\n  {% endif %}\r\n  {%- if video[\"flv:mediainfo\"] -%}\r\n    {%- set height = video[\"flv:mediainfo\"].videos[0].height.absoluteValue -%}\r\n  {%- else  -%}\r\n    {%- set height = 480 -%}\r\n  {%- endif -%}\r\n  {%- set thumb_width = width < max_thumb_width ? width: max_thumb_width -%}\r\n  {%- set thumb_height = (thumb_width\/width * height)|round() -%}\r\n  {% set thumbnail -%}\r\n  \"thumbnail\": [\r\n          {\r\n            \"id\": \"{{ cantaloupeid }}1;\/full\/{{thumb_width}},\/0\/default.jpg\",\r\n            \"type\": \"Image\",\r\n            \"format\": \"image\/jpeg\",\r\n            \"width\": {{ thumb_width }},\r\n            \"height\": {{ thumb_height }}\r\n          }\r\n        ],\r\n  {%- endset %}\r\n    {\r\n    \"id\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ itemCount }}\",\r\n    \"type\": \"Canvas\",\r\n    \"label\": { \"{{ len }}\": [\r\n      {%- if (video_count > 1) -%}\r\n      {{ (loop.index ~ ' of ' ~ video_count ~ ' videos: ' ~ data.label)|json_encode|raw }}\r\n      {% else %}\r\n      \r\n       {{ (\"Video:\" ~ data.label)|json_encode|raw }}\r\n      {%- endif -%}\r\n      ]},\r\n    \"width\": {{ width }},\r\n    \"height\": {{ height }},\r\n    {{ thumbnail }}\r\n    \"duration\": {{ video[\"flv:mediainfo\"].videos[0].duration.milliseconds|default(1000) }},\r\n    \"items\": [\r\n        {\r\n          \"id\": \"{{ nodeurl }}\/iiif\/page\/p{{ itemCount }}\",\r\n          \"type\": \"AnnotationPage\",\r\n          \"items\": [\r\n            {\r\n              \"id\": \"{{ nodeurl }}\/iiif\/annotation\/p{{ itemCount }}\",\r\n              \"type\": \"Annotation\",\r\n              \"motivation\": \"painting\",     \r\n              {{ thumbnail }}          \r\n              \"body\": {\r\n                \"id\": \"{{ Webserverurl }}do\/{{ node.id }}\/iiif\/{{ video['dr:uuid'] }}\/full\/full\/0\/{{  video.name }}\",\r\n                \"type\": \"Video\",\r\n                \"format\": \"{{ video[\"flv:mediainfo\"].general.internet_media_type }}\",\r\n                \"duration\": {{ video[\"flv:mediainfo\"].videos[0].duration.milliseconds|default(1000) }},\r\n                \"height\": {{ height }},\r\n                \"width\": {{ width }}\r\n              },\r\n              \"target\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ itemCount }}\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }{{ not loop.last ? ',' : '' }}\r\n  {% endfor %}\r\n{% endif %}\r\n{# Audio Manifest #}\r\n{%- if (attribute(data, 'as:audio')|length > 0) -%}\r\n{%- if itemCount > 0 -%}\r\n,\r\n{%- endif -%}\r\n{#- Count Audio upfront -#}\r\n{%- set audio_count = attribute(data, 'as:audio')|length -%}\r\n{% for audio in attribute(data, 'as:audio') %}\r\n{%- set itemCount = itemCount + 1 -%}\r\n    {\r\n    \"id\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ itemCount }}\",\r\n    \"type\": \"Canvas\",\r\n    \"label\": { \"{{ len }}\": [\r\n      {%- if (audio_count > 1) -%}\r\n        {{ (loop.index ~ ' of ' ~ audio_count ~ ' audios: ' ~ data.label)|json_encode|raw }}\r\n      {% else %}\r\n        {{ (\"Audio:\" ~ data.label )|json_encode|raw }}\r\n      {%- endif -%}\r\n      ]},\r\n    \"duration\": {{ audio[\"flv:mediainfo\"].audios[0].duration.milliseconds|default(1000) }},\r\n    \"items\": [\r\n        {\r\n          \"id\": \"{{ nodeurl }}\/iiif\/page\/p{{ itemCount }}\",\r\n          \"type\": \"AnnotationPage\",\r\n          \"items\": [\r\n            {\r\n              \"id\": \"{{ nodeurl }}\/iiif\/annotation\/p{{ itemCount }}\",\r\n              \"type\": \"Annotation\",\r\n              \"motivation\": \"painting\",      \r\n              \"body\": {\r\n                \"id\": \"{{ Webserverurl }}do\/{{ node.id }}\/iiif\/{{ audio['dr:uuid'] }}\/full\/full\/0\/{{  audio.name }}\",\r\n                \"type\": \"Sound\",\r\n                \"format\": \"{{ audio[\"flv:mediainfo\"].general.internet_media_type }}\",\r\n                \"duration\": {{ audio[\"flv:mediainfo\"].audios[0].duration.milliseconds|default(1000) }}\r\n              },\r\n              \"target\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ itemCount }}\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }{{ not loop.last ? ',' : '' }}\r\n  {% endfor %}\r\n{% endif %}\r\n  ]\r\n}","langcode":"und","mimetype":"application\/json","name":"IIIF Presentation API 3 Creative Works Series Child Canvases"}}}