{
  "data": {
    "type": "metadatadisplay_entity--metadatadisplay_entity",
    "id": "6c405928-9ae8-4557-b062-91fcf2b0af0a",
    "attributes": {
      "name": "IIIF Presentation API 3 Creative Works Series Manifest",
      "twig": "{# \nUpdated 07\/08\/2022 for 1.0.0\n\nThis Template generates IIIF 3.0 API Manifest for Creative Works Series using a Drupal Views\nJSON to be used by a Drupal Views (REST) to generate a simpler to parse\/join listing of Canvases\nFor a Creative Works Series Manifest\n\nStructures passed from Archipelago are\n- node\n  The full Node entity\n- data\n  The Full JSON Structure converted in an Array\n- iiif_server\n  The publicly available IIIF Server (Global Setting)\n\nSince JSON was decoded into the 'data' values are valid PHP but could not\nbe valid JSON when outputting. So We use data.description|json_encode|raw\nWithout Double quotes.\n#}\n{% set Webserverurl =  url('<front>')|render|replace({':8001\/':''}) ~ ':8183\/iiif\/2\/' %}\n{% set IIIFserverurl = iiif_server ? iiif_server ~ '\/': Webserverurl %}\n{% set currenturl = url('<current>')|render %}\n{% if node.id %}\n\t{# this is needed to the View Argument can conform to the format even when no node exists when saving the template #}\n    {% set nodeid = node.id %}\n    {% set nodeurl = url('entity.node.canonical', {'node': node.id}, {'absolute': true}) %}\n{% else %}\n    {% set nodeid = 1 %} \n    {% set nodeurl = currenturl %}\n{% endif%}\n{% set len = language.getId() ? language.getId() : \"en\" %}\n{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\n{% if data.rights|length > 0 or data.rights_statements|length > 0 %}\n\t{% if data.rights|length > 0 %} \n\t\t{% set computed_rights = data.rights %}\n\t{% endif %}\n{% elseif data.rights_statements|length > 0 %}\n\t{% if data.rights_statements in ['In Copyright'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - EU Orphan Work'] %} \n    \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-OW-EU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Educational Use Permitted'] %} \n\t   \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Non-Commercial Use Permitted'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-NC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Rights-holder(s) Unlocatable or Unidentifiable'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-RUU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - Contractual Restrictions'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-CR\/1.0\/\" %}\n\t{% endif %} \n\t{% if data.rights_statements in ['No Copyright - Non-Commercial Use Only'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-NC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - Other Known Legal Restrictions'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-OKLR\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - United States'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-US\/1.0\/\" %}\n\t{% endif %} \n\t{% if data.rights_statements in ['Copyright Not Evaluated'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/CNE\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['Copyright Undetermined'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/UND\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Known Copyright'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NKC\/1.0\/\" %}\n\t{% endif %}\n{% endif %}\n{\n{# Top Object Metadata #}\n\"@context\": [\n  \"http:\/\/www.w3.org\/ns\/anno.jsonld\",\n  \"http:\/\/iiif.io\/api\/presentation\/3\/context.json\"\n],\n\"type\": \"Manifest\",\n\"id\": \"{{ currenturl }}\",\n\"label\": {\n\"{{ len }}\": [\n{{ node.label|json_encode|raw }}\n]\n},\n\"requiredStatement\": {\n\"label\": { \"en\": [ \"Attribution\" ] },\n\"value\": { \"en\": [ \"Provided by Archipelago Deployment\" ] }\n},\n\"rights\": {{ computed_rights|json_encode|raw }},\n\"metadata\": [\n{% for agent in attribute(data, 'edm_agent') %}\n    {\n    \"label\": {\n    \"{{ len }}\": [\n    {{ agent.role_label|json_encode|raw }}\n    ]\n    },\n    \"value\": {\n    \"{{ len }}\": [\n    {{ agent.name_label|json_encode|raw }}\n    ]\n    }\n    },\n{% endfor %}\n{\n\"label\": {\n\"{{ len }}\": [\n\"description\"\n]\n},\n\"value\": {\n\"{{ len }}\": [\n{{ data.description|json_encode|raw }}\n]\n}\n},\n{\n\"label\": {\n\"{{ len }}\": [\n\"navDate\"\n]\n},\n\"value\":  {\n\"{{ len }}\": [\n\"{{ node.getChangedTime|date(\"F jS \\\\a\\\\t g:ia\") }}\"\n]\n}\n},\n{\n\"label\": {\n\"{{ len }}\": [\n\"license\"\n]\n},\n\"value\": {\n\"{{ len }}\": [\n{{ computed_rights|json_encode|raw }}\n]\n}\n}\n],\n{% if attribute(data, 'memberof') %}\n    {% set currentnode = 'node\/' ~ data.memberof %}\n    \"within\": \"{{ url(currentnode) }}\",\n{% else %}\n    {% set currentnode = '<current>' %}\n{% endif %}\n{# fetch all children using a View and attach them as Items #}\n\"items\": [\n{% set canvases_view = drupal_view('data_creativeworks_series','children_ispartof_canvas_rest', nodeid)|render %}\n{% set canvases_items = canvases_view|sbf_json_decode %}\n{% set ranges = {} %}\n{% for canvas in canvases_items %}\n{# canvas|json_encode #}\n  {% set items = canvas['canvas']|sbf_json_decode %}\n  {% for item in items['items'] %}\n    {% set ranges = ranges|merge({ (loop.index0 + loop.parent.loop.index0): item['id']}) %}\n    {{ item|json_encode(constant('JSON_PRETTY_PRINT'))|raw }}{{ not loop.parent.loop.last or not loop.last ? ',' : '' }}\n  {% endfor %}\n{% endfor %}\n],\n\"structures\": [{\n  \"id\": \"{{ nodeurl }}\/iiif\/range\/r1\",\n  \"type\": \"Range\",\n  \"label\": {\n    \"{{ len }}\": [\n      {{ data.label|json_encode|raw  }}\n   ]\n  },\n  \"items\": [\n{% for range in ranges %}\n    {\n    \"id\": {{ range|json_encode|raw }},\n    \"type\": \"Canvas\"\n    }{{ not loop.last ? ',' : '' }}\n{% endfor %}\n  ]\n}]\n}", 
      "langcode": "und",
      "mimetype": "application/ld+json"
    }
  }
}
