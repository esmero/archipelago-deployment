{
    "data": {
        "type": "metadatadisplay_entity--metadatadisplay_entity",
        "id": "f13e8744-f6b2-46fc-8744-ef153e4c49f4",
        "attributes": {
            "name": "Thumbnails with Annotations for ML",
            "langcode": "und",
            "mimetype": "text/html",
            "twig": "{# This Template generates Thumbnails with Dynamic Web Annotations that can trigger ML image similaries\r\nUpdated on 07/07/2024 for 1.4.0 for Cantaloupe 6.x \r\nStructures passed from Archipelago are \r\n- node \r\n  The full Node entity \r\n- data \r\n  The Full JSON Structure converted in an Array \r\n- iiif_server \r\n  The publicly available IIIF Server (Global Setting) \r\nSince JSON was decoded into the 'data' values are valid PHP but could not \r\nbe valid JSON when outputting. So We use data.description|json_encode|raw \r\nWithout Double quotes. \r\n#} \r\n{# <---- SETUP ---> #} \r\n{# -- The Desired width -- #} \r\n{% set width = 240 %} \r\n{# -- The IIIF Server URLS -- #} \r\n{% set Webserverurl =  url('<front>')|render|replace({':8001/':''}) ~ ':8183/iiif/2/' %} \r\n{% set IIIFserverurl = iiif_server ? iiif_server ~ '/': Webserverurl %} \r\n{% set file_uuid = null %}\r\n{# -- Node Info -- #} \r\n{% if node.id %} \r\n  {% set nodeurl = url('entity.node.canonical', {'node': node.id}, {'absolute': true}) %} \r\n{% else %} \r\n  {% set nodeurl = '<current>' ~ '/iiif/manifest' %} \r\n{% endif%} \r\n{# -- Language -- #} \r\n{% set len = language.getId() ? language.getId() : \"en\" %} \r\n{# --THIS WILL BE THE IMAGE IIIF URL. CAN HAVE A DEFAULT VALUE IN CASE OF FAILURE THERE IS ALWAYS A GENERIC THUMB-- #} \r\n{# -- NOTE: for loops are scoped so if we only define source inside one it will not be accesible from the outside- #} \r\n{% set source = '' %} \r\n{# <---- END SETUP --> #} \r\n{#  We will test for 3 main options \r\n1.- Images \r\n2.- PDF \r\n3.- Movies \r\n#} \r\n{% apply spaceless %} \r\n{% if attribute(data, 'as:image')|length > 0 %} \r\n  {% set document  = data['as:image']|first %} \r\n  {# if the default size is smaller than the source use the source one #} \r\n  {% if document['flv:exif'].ImageWidth is defined and document['flv:exif'].ImageWidth < width %} \r\n     {% set width = document['flv:exif'].ImageWidth %} \r\n  {% endif %} \r\n  {% set cantaloupeid  = IIIFserverurl ~ document['url']|replace({'s3://':''})|replace({'private://':''})|url_encode %} \r\n  {% if logged_in  %}\r\n    {% set width = 480 %} \r\n  {% endif %}\r\n  {% set source = cantaloupeid ~ \"/full/\" ~ width  ~ \",/0/default.jpg\" %} \r\n  {% set file_uuid = document['dr:uuid'] %} \r\n{% elseif attribute(data, 'as:document')|length > 0 %} \r\n  {% set break = false %} \r\n  {% for document in data['as:document']%} \r\n{#- WIZARDLY UPDATED BY ARCHIPELAGO -#} \r\n{%  if not break %} \r\n  {# this is just an example, we  allow every PDF here but we can also filter by pronom id \"info:pronom/fmt/17\" or info:pronom/fmt/18 #} \r\n    {% if document['flv:exif'].MIMEType == \"application/pdf\" and document['flv:exif'].PageCount > 0 %} \r\n      {% set cantaloupeid  = IIIFserverurl ~ document['url']|replace({'s3://':''})|replace({'private://':''})|url_encode %} \r\n      {% set source = cantaloupeid ~ \";1\" ~\"/full/\" ~ width  ~ \",/0/default.jpg\" %} \r\n      {% set break = true %} \r\n    {% endif%} \r\n  {#- WIZARDLY UPDATED BY ARCHIPELAGO -#} \r\n{% endif %} \r\n{% endfor %} \r\n{% elseif attribute(data, 'as:video')|length > 0 %} \r\n  {% set break = false %} \r\n  {% for document in data['as:video']%} \r\n{#- WIZARDLY UPDATED BY ARCHIPELAGO -#} \r\n{%  if not break %} \r\n  {# this is just an example, we process here only MP4 quicktimes #} \r\n    {% if document['flv:pronom'].mimetype == \"video/quicktime\" %} \r\n      {% set cantaloupeid  = IIIFserverurl ~ document['url']|replace({'s3://':''})|replace({'private://':''})|url_encode %} \r\n      {% set source = cantaloupeid ~ \";1/full/\" ~ width  ~ \",/0/default.jpg\" %} \r\n      {% set break = true %} \r\n    {% endif %} \r\n  {#- WIZARDLY UPDATED BY ARCHIPELAGO -#} \r\n{% endif %} \r\n{% endfor %} \r\n{% endif%} \r\n{# <----START OUTPUT --> #} \r\n<a href=\"{{ nodeurl }}\" alt=\"{{ node.label.value }}\" hreflang=\"{{ len }}\"> \r\n{% if source|length > 0 %} \r\n{# NOTE: remote iiif-lazy class if you do not want lazy loading #}\r\n  {% set annon_attributes = '' %}\r\n  {% if logged_in and file_uuid %}\r\n    {% set annon_attributes = ' data-sbf-annotations-nodeuuid=' ~ node.uuid.value ~ ' data-sbf-annotations-fileuuid=' ~ file_uuid ~ ' data-sbf-annotations-processors=ml_yolov8' %}\r\n  {% endif %}\r\n<img class=\"field-iiif image-iiif iiif-lazy img-fluid rounded\"{{ annon_attributes }} id=\"thumb_iiif-field_descriptive_metadata-{{ node.uuid.value }}-0-image1\" src=\"{{ source }}\" width=\"{{ width }}\" alt=\"Thumbnail for {{ node.label.value }}\" typeof=\"foaf:Image\"> \r\n{% else %} \r\n{# -- IF we have no source we can e.g use font awesome -- #} \r\n{# \r\nOptions we took from /admin/structure/webform/config/options/manage/schema_org_creative_works/source \r\nArticle: Article \r\nBook: Book \r\nCollection: Collection \r\nDataset: Dataset \r\nDigitalDocument: 'Digital Document' \r\nMap: Map \r\nMovie: Movie \r\nMusicRecording: 'Music Recording' \r\nPainting: Painting \r\nPhotograph: Photograph \r\nSculpture: Sculpture \r\nVisualArtwork: VisualArtwork \r\nThesis: Thesis \r\nPodcast: Podcast \r\nPodcastEpisode: 'Podcast Episode' \r\nPanorama: 'Panorama (http://ns.google.com/photos/1.0/panorama)' \r\nPanoramaTour: 'Panorama Tour (http://ns.google.com/photos/1.0/panorama)' \r\n3DModel: '3D Model' \r\nWebPage: 'Web Page' \r\nAudioObject: 'Audio Object' \r\nVideoObject: 'Video Object' \r\nConversation: 'Conversation (Oral History)' \r\nShortStory: 'Short Story' \r\n#} \r\n{% if data.type in ['DigitalDocument', 'Article','Thesis'] %} \r\n<i class=\"fas fa-file-alt fa-9x\"></i> \r\n{% elseif data.type in ['Photograph','Painting','VisualArtwork'] %} \r\n<i class=\"fas fa-photo-video fa-9x\"></i> \r\n{% elseif data.type in ['Movie','VideoObject'] %} \r\n<i class=\"fas fa-film fa-9x\"></i> \r\n{% elseif data.type in ['MusicRecording', 'AudioObject'] %} \r\n<i class=\"fas fa-headphones-alt fa-9x\"></i> \r\n{% elseif data.type in ['Podcast','PodcastEpisode'] %} \r\n<i class=\"fas fa-podcast\"></i> \r\n{% elseif data.type in ['ShortStory','Conversation',] %} \r\n<i class=\"fas fa-comments fa-9x\"></i> \r\n{% elseif data.type in ['Sculpture','3DModel'] %} \r\n<i class=\"fas fa-cubes fa-9x\"></i> \r\n{% elseif data.type in ['Book'] %} \r\n<i class=\"fas fa-book fa-9x\"></i> \r\n{% elseif data.type in ['WebPage'] %} \r\n<i class=\"fas fa-sitemap fa-9x\"></i> \r\n{% elseif data.type in ['Panorama','PanoramaTour'] %} \r\n<i class=\"fas fa-vr-cardboard fa-9x\"></i> \r\n{% elseif data.type in ['Dataset'] %} \r\n<i class=\"fas fa-table fa-9x\"></i> \r\n{% elseif data.type in ['CreativeWorkSeries'] %} \r\n<i class=\"fab fa-buffer fa-9x\"></i> \r\n{% elseif data.type in ['Collection'] %} \r\n<i class=\"fas fa-archive fa-9x\"></i> \r\n{% elseif data.type in ['Map'] %} \r\n<i class=\"fas fa-map-marked-alt fa-9x\"></i> \r\n{% else %} \r\n<i class=\"fas fa-file-contract fa-9x\"></i> \r\n{% endif %} \r\n{# -- ENDIF fontawesome -- #} \r\n{% endif %} \r\n</a> \r\n{% endapply %}"
        }
    }
}